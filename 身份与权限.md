## 身份与权限

### /etc/passwd文件字段说明
passwd文件是用于存放用户信息的文件, 虽然叫passwd但现在里面并没有存放用户的密码. 用户类型主要分三类, 1. 管理员账号(root),uid为0, 伪账号或者叫系统账号, 这些账号是系统中默认的账号, 主要用于系统管理, 他们都不能 登陆. uid为1-999. 普通账号, uid为1000-60000
```bash
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
```
1. 用户名. 
2. 以前用户存放密码, 现在用x代替, 密码改存到`/etc/shadow`中了. 
3. 用户ID(uid). 
4. 组ID(gid). 
5. 注释性描述, 记录着用户的一些个人情况，例如用户的真实姓名、电话、地址等，这个字段并没有什么实际的用途。在不同的Linux系统中，这个字段的格式并没有统一. 
6. 主目录, 用户的起始工作目录，是用户在登录到系统之后所处的目录. 
7. 登录Shell(Shell):用户登录后，要启动一个进程，负责将用户的操作传给内核，这个进程是用户登录到系统后运行的命令解释器或某个特定的程序，即Shell.

### /etc/stadow文件字段说明
该文件才是存放用户密码的地方, 密文字符串格式为：$id$salt$encrypted，通过$来分割, 其中$id用来指定使用的算法,id对应数字的含义, 1: MD5, 2a: Blowfish, 只在有一部分linux分支中使用的加密方法, 5: SHA-256, 6: SHA-512. $salt是一个最多16个字符的随机生成的字符串，用来增加破解难度. $encrypted就是通过加密算法和salt算出来的密文.
```bash
root:$6$YZX6e34ZL/7$FcZWmjybzKJ.ZVfTZ/To4i.ERiu75takDwDd/AVBeOy.gW5vPUcLcGAAXOCZxQT/fGsoaNb5rzdz84PHE2h9M0::0:99999:7:::
bin:*:17632:0:99999:7:::
daemon:*:17632:0:99999:7:::
adm:*:17632:0:99999:7:::
user1:!!:17878:0:99999:7:::
user2:$6$YZX6e34ZL/7$FcZWmjybzKJ.ZVfTZ/To4i.ERiu75takDwDd/AVBeOy.gW5vPUcLcGAAXOCZxQT/fGsoaNb5rzdz84PHE2h9M0:17877:0:99999:7:::
```
1. 用户名: 和/etc/passwd中的用户名对应
2. 加密后的密码: 格式为$id$salt$encrypted, 如果为星号(*)表示账号被锁定, 双感叹号(!!)表示密码已过期, 如果为空表示改用户没有密码.
3. 最后一次修改密码的时间: 表示的是从某个时刻起(如:1970, 不同系统起始时间不一样),到用户最后一次修改密码时间的天数.
4. 最小时间间隔: 指的是两次修改口令之间所需的最小天数
5. 最大时间间隔: 指的是口令保持有效的最大天数
6. 警告时间: 表示的从系统开始警告用户到用户密码正式失效之间的天数
7. 活动时间: 表示的是用户没有登录活动但账号仍能保持有效的最大天数
8. 失效时间: 给出的是一个绝对的天数,如果使用了这个字段,那么就给出相应账号的生存期。期满后,该账号就不再是一个合法的账号,也就不能再用来登录了


### 用户和用户组

### 添加用户--useradd
```bash
useradd [选项] 用户名
```
最简单的方式就是不带参数直接添加用户`useradd user1`, 之后系统会自动做一些事情, 1. 在/home目录下面创建一个和用户相同的目录. 2. 把/etc/skel目录下的文件复制到用户目录(skeleton). 3. 创建用户的同时会给用户创建和用户名相同的用户组, 用户的uid和gid默认相同 4. 根据/etc/login.defs文件中的配置信息设置用户的相关属性. 系统做这些事情的顺序和描述的顺序不一致.

新添加的用户如果不设置密码centos中时无法登陆的, 其他的一些系统可以无密码登陆.

### 设置用户密码
有两个命令可以设置用户密码passwd和chpasswd, chpasswd用于批量设置密码, passwd修改密码时会走pam机制,通过ldd我们看passwd依赖pam模块.
```bash
passwd [选项] 用户名
```
用户chpasswd修改用户密码时需要一个特定格式的文件,文件格式如下
```txt
用户名:密码
用户名:密码
```
然后使用按下面的方式使用
```bash
cat passworld.txt | chpasswd
```
### 删除用户
```bash
userdel -r 用户名
```
删除用户, 如果不用参数r, 用户的主目录和邮箱目录时不会删除的.

### 添加用户组